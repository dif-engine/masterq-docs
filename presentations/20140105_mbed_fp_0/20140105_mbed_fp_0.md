# Functional MCU programming #0: Development environment

Metasepi Project / Kiwamu Okabe

# Who am I ?
![background](img/enjoy.png)

* http://www.masterq.net/
* Twitter: @master_q
* Organizer of Metasepi Project
* A developer of Ajhc Haskell compiler
* A Debian Maintainer
* 10 years' experience in developing OS using NetBSD.

# Why functional lang for MCU?

* Avoid runtime error in IoT world
* We need strong type !

# Overview

![inline](draw/env_overview.png)

# MCU (Microcontroller)

Many architecture are on the earth.

# MCU: ARM Cortex-M
![background](img/mbed_x_stm32.png)

* Major
* 32bit
* Large memory size (> 20kB)

Good MCU Board is ...

* mbed LPC1768 (5,200 YEN)

~~~
https://mbed.org/platforms/mbed-LPC1768/
~~~

* STM32F4DISCOVERY (1,650 YEN)

~~~
http://www.st.com/web/catalog/tools/FM116/SC959/SS1532/PF252419
~~~

# MCU: TI MSP430
![background](img/msp-exp430g2_launchpad.png)

* Minor
* 16bit
* Small memory size (< 4kB)

Good MCU Board is ...

* MSP-EXP430G2 (1,202 YEN)

http://www.ti.com/tool/msp-exp430g2

# MCU: Atmel AVR
![background](img/ArduinoMega2560.png)

* Major
* 8bit and Harvard architecture
* Small memory size (< 8kB)

Good MCU Board is ...

* Arduino Mega 2560 compat board (2,690 YEN)

~~~
http://www.amazon.co.jp/dp/B00CF2REXC
~~~

# Cross compiler

* Functional language implementation
* many many many ...
* Which language good for MCU ?

# Cross compiler: (A)jhc
![background](img/ajhc.png)

http://ajhc.metasepi.org/

* Language: Haskell
* Haskell is major !
* Need GC heap = Need more memory
* Experience running on MCU

~~~
ARM Cortex-M
https://github.com/ajhc/demo-cortex-m3
~~~

# Cross compiler: ATS
![background](img/ats_hongwei.png)

http://www.ats-lang.org/

http://jats-ug.metasepi.org/

* Language: ML
* Optional GC = Need low memory
* No experience running on MCU

# Cross compiler: Rust
![background](img/rust.png)

http://www.rust-lang.org/

* Language: Own syntax like C or JS
* Optional GC = Need low memory
* Experience running on MCU

~~~
ARM Cortex-M
https://github.com/neykov/armboot
~~~

* @pirapira knows detail of it

# gdbserver (Debugger)

* Gdb is major debugger
* But gdb is only for the program running on your PC
* How debug program running on MCU ?
* Gdbserver is good for the use case
* There are many implementation

# gdbserver: OpenOCD

http://openocd.sourceforge.net/

* Support many MCU

ARM7, ARM9, ARM11, ARM Cortex-M, XScale, MIPS m4k, Orion SoC

* Support many JTAG
* Need config file

# gdbserver: pyOCD

https://github.com/mbedmicro/pyOCD

* Only for MCU using CMSIS-DAP
* But now support only mbed LPC1768
* In future, support more board ?

Seeeduino Arch Pro ($43.41)

~~~
http://www.seeedstudio.com/depot/arch-pro-p-1677.html
~~~

FRDM-KL46Z (1,634 YEN)

~~~
http://www.freescale.com/webapp/sps/site/prod_summary.jsp?code=FRDM-KL46Z
~~~

# gdbserver: STLINK

https://github.com/texane/stlink

* Only for STM32 MCU
* STM32 is based on ARM Cortex-M
* No config is good config

# gdbserver: AVaRICE

http://avarice.sourceforge.net/

* Only for Atmel AVR

# Serial comsole
# Peripheral
# Ethernet
# OS
