# Dive into RTS - another side
![background](diving.png)

Kiwamu Okabe

# 宣伝:同人誌にRTSの話を書きました

~~~
http://www.paraiso-lang.org/ikmsm/books/c82.html
~~~

とらのあな通販で買ってね!

![inline](c82-cover.png)

# 今日もRTSの話をするのですが
![background](spotlight.png)

せっかくなので、同人誌とは別方面からRTSの解析をすすめてみようと思います。

# 別方面、、、それは、、、GDB!
![background](footstep.png)

GHCが吐き出す実行バイナリはGDBを使って解析できます。

# GHCをソースコードからインストール

RTSにデバッグシンボルが付いてきます。

~~~
$ objdump -x /usr/local/ghc7.4.1/lib/ghc-7.4.1/libHSrts.a
--snip--
  5 .debug_info   00003a7b  0000000000000000  0000000000000000  000070dd  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
  6 .debug_abbrev 000002eb  0000000000000000  0000000000000000  0000ab58  2**0
                  CONTENTS, READONLY, DEBUGGING
  7 .debug_loc    00001140  0000000000000000  0000000000000000  0000ae43  2**0
                  CONTENTS, READONLY, DEBUGGING
  8 .debug_aranges 00000030  0000000000000000  0000000000000000  0000bf83  2**0
                  CONTENTS, RELOC, READONLY, DEBUGGING
  9 .debug_ranges 000002f0  0000000000000000  0000000000000000  0000bfb3  2**0
                  CONTENTS, READONLY, DEBUGGING
~~~

# 天下り的にブレークポイントを決める

# バックトレースを取ってみると。。。

# STG/Cmm Kung Fuになろう!
![background](bruce_lee.png)

論文読んでもコード読んでも実感わかないので、以下の例をGDBで追い掛けてみましょう。

~~~
"I know kung fu: learning STG by example"
http://hackage.haskell.org/trac/ghc/wiki/Commentary/Compiler/GeneratedCode
~~~

# スライドで使用した画像について
![background](flickr.png)

~~~
Diving | Flickr - Photo Sharing!
  http://www.flickr.com/photos/stevenworster/7984634155/
Bruce Lee | Flickr - Photo Sharing!
  http://www.flickr.com/photos/ryan_fors/2230311347/
footsteps | Flickr - Photo Sharing!
  http://www.flickr.com/photos/penguincakes/3341325038/
Spotlight on the M's | Flickr - Photo Sharing!
  http://www.flickr.com/photos/scooty/116414915/
flickr Badges | Flickr - Photo Sharing!
  http://www.flickr.com/photos/poolie/2271154446/
~~~
